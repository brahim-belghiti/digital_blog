import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.BVOCwoKb.js";function N(){const[u,g]=f.useState([]),[p,v]=f.useState(400),b=f.useRef(null);f.useEffect(()=>{const e=document.querySelector("article");if(!e)return;const l=async r=>{const i=r.target.closest("a");if(i&&i.href.includes("/blog/")&&!i.getAttribute("target")){r.preventDefault();const t=new URL(i.href).pathname.split("/blog/")[1];if(console.log("Detected slug:",t),t){const c=u.findIndex(s=>s.slug===t);if(c>=0)g(s=>s.slice(0,c+1));else{g(s=>[...s,{slug:t,title:t.replace(/-/g," "),content:"",isLoading:!0}]);try{console.log("Fetching note content for:",t);const s=await fetch(`/api/note/${t}`);if(console.log("ðŸš€ ~ handleClick ~ response:",s),!s.ok)throw new Error(`Failed to load note: ${s.statusText}`);const a=await s.json();console.log("Received data:",a),g(o=>o.map(d=>d.slug===t?{...d,title:a.title,content:a.content,tags:a.tags,date:a.date,isLoading:!1}:d))}catch(s){console.error("Error loading note:",s),g(a=>a.map(o=>o.slug===t?{...o,content:"Failed to load note content.",isLoading:!1}:o))}}}}};return e.addEventListener("click",l),()=>e.removeEventListener("click",l)},[u]),f.useEffect(()=>{const e=b.current;if(!e)return;const l=async r=>{const m=r.target,i=m.closest("a");if(!i||!i.href.includes("/blog/")||i.getAttribute("target"))return;r.preventDefault();const t=new URL(i.href).pathname.split("/blog/")[1];if(!t)return;let c=m,s=-1;for(;c&&!c.hasAttribute("data-note-index");)c=c.parentElement;if(c&&(s=parseInt(c.getAttribute("data-note-index")||"-1",10)),s>=0){g(a=>{const o=a.findIndex(h=>h.slug===t);if(o>=0){const h=Math.min(s+1,o);return a.slice(0,h)}return[...a.slice(0,s+1),{slug:t,title:t.replace(/-/g," "),content:"",isLoading:!0}]});try{const a=await fetch(`/api/note/${t}`);if(!a.ok)throw new Error(`Failed to load note: ${a.statusText}`);const o=await a.json();g(d=>d.map(h=>h.slug===t?{...h,title:o.title,content:o.content,tags:o.tags,date:o.date,isLoading:!1}:h))}catch(a){console.error("Error loading note:",a),g(o=>o.map(d=>d.slug===t?{...d,content:"Failed to load note content.",isLoading:!1}:d))}}};return e.addEventListener("click",l),()=>e.removeEventListener("click",l)},[u]);const y=e=>{const l=u.findIndex(r=>r.slug===e);l>=0&&g(r=>r.slice(0,l))},w=(e,l)=>{e.preventDefault();const r=e.clientX,m=p,i=t=>{const c=t.clientX-r,s=Math.max(300,Math.min(600,m+c));v(s)},x=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",x)};return u.length===0?null:n.jsx("div",{ref:b,className:"fixed top-0 right-0 h-full flex overflow-hidden z-10 shadow-xl",style:{paddingLeft:u.length?"60px":0},children:u.map((e,l)=>n.jsxs("div",{"data-note-index":l,className:"h-full bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-700 overflow-auto relative flex-shrink-0",style:{width:`${p}px`},children:[l>0&&n.jsx("div",{className:"absolute left-0 top-0 w-1 h-full cursor-ew-resize hover:bg-blue-400 z-30",onMouseDown:r=>w(r)}),n.jsxs("div",{className:"sticky top-0 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center z-20",children:[n.jsx("h2",{className:"text-lg font-semibold text-black dark:text-white truncate",children:e.title}),n.jsx("button",{onClick:()=>y(e.slug),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200","aria-label":"Close note",children:"Ã—"})]}),n.jsx("div",{className:"p-4",children:e.isLoading?n.jsxs("div",{className:"animate-pulse",children:[n.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4"}),n.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-4"}),n.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6 mb-4"})]}):n.jsxs(n.Fragment,{children:[e.date&&n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:new Date(e.date).toLocaleDateString()}),n.jsx("div",{className:"prose dark:prose-invert max-w-none font-sans",dangerouslySetInnerHTML:{__html:e.content}}),e.tags&&e.tags.length>0&&n.jsx("div",{className:"mt-6 flex flex-wrap gap-2",children:e.tags.map(r=>n.jsxs("span",{className:"inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full",children:["#",r]},r))})]})})]},e.slug))})}export{N as default};
